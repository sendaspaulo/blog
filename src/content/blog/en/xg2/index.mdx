---
title: "Expected Goals (xG) ‚Äì Interpretabilidade e Desempenho com XGBoost"
description: "Pipeline completo, da coleta de eventos StatsBomb √† explica√ß√£o do XGBClassifier, avaliando m√©tricas de calibra√ß√£o e curva ROC"
date: 2025-05-05
cover: "./xg_cover.jpg"   # substitua por um heat-map de xG ou diagrama do fluxo
tags:
  - Python
  - Machine Learning
  - Sports Analytics
  - XGBoost
  - Explainable AI
---

> Continua√ß√£o e aprimoramento do projeto de *Expected Goals*: aqui exploramos **XGBClassifier**, calibramos previs√µes e tornamos o modelo interpret√°vel com **SHAP**. O notebook completo est√° em `xG_2.ipynb` no reposit√≥rio [xG-StatsBomb-Analysis](https://github.com/sendaspaulo/xG-StatsBomb-Analysis).

## üéØ Objetivo

Refinar a estimativa de probabilidade de gol utilizando **XGBoost** e comprovar ganho de performance sobre abordagens cl√°ssicas, avaliando n√£o s√≥ AUC mas tamb√©m *Brier Score* e curva de calibra√ß√£o, al√©m de explicar a contribui√ß√£o de cada vari√°vel.

## üîÑ Pipeline

1. **Coleta & Limpeza**  
   `data_ingest.py` baixa partidas da Premier League 2015-16 via *statsbombpy* e gera `events.parquet`.  

2. **Feature Engineering**  
   * Dist√¢ncia (**distance**) e √¢ngulo (**angle**) do chute.  
   * Flags contextuais: **shot_first_time**, **shot_one_on_one**, **shot_open_goal**.  
   * Situa√ß√£o da jogada (bola rolando, p√™nalti, falta, cabeceio).  
   * Minuto da partida e diferen√ßa de placar (**score_diff**).  

3. **Modelagem**

   | Modelo | Ferramenta | ROC AUC* | Brier* |
   |--------|------------|---------:|-------:|
   | Regress√£o Log√≠stica | scikit-learn | 0,73 | 0,38 |
   | Random Forest       | scikit-learn | 0,79 | 0,34 |
   | **XGBClassifier**   | xgboost      | **0,82** | **0,31** |

   \* valida√ß√£o estratificada 70/30, m√©dia de 3 execu√ß√µes.

4. **Avalia√ß√£o Avan√ßada**  
   * Curvas ROC e *Precision-Recall*.  
   * *Calibration plots* (previsto √ó real).  
   * *Brier Skill Score* comparando com xG oficial da StatsBomb.  

5. **Interpretabilidade**  
   `explain.py` gera:  
   * Gr√°fico **SHAP Summary** destacando influ√™ncia de **distance** e **angle**.  
   * **Force plots** e **waterfall** para chutes espec√≠ficos (ex.: final da UCL 2016).

6. **Exporta√ß√£o & Deploy**  
   `export_model.py` salva o booster `.json`; `app.py` exp√µe REST API (`/predict`) pronta para embutir em dashboards.

## üí° Resultados em Destaque

* **XGBClassifier** reduziu *Brier Score* em 18 % versus regress√£o log√≠stica, indicando melhor calibra√ß√£o de probabilidade.  
* Chutes de dentro da pequena √°rea, com √¢ngulo ‚â§ 30 ¬∞, apresentam xG m√©dio ‚â• 0,45.  
* Cabeceios continuam com xG 40 % inferior aos chutes com o p√© mesmo a curta dist√¢ncia.  
* SHAP confirma que a intera√ß√£o **distance √ó angle** √© o principal driver de xG.

## üöÄ Como Rodar

```bash
git clone https://github.com/sendaspaulo/xG-StatsBomb-Analysis.git
cd xG-StatsBomb-Analysis
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt         # statsbombpy, xgboost, shap...

python data_ingest.py                  # baixa e processa dados
python train.py --model xgb --epochs 100
python explain.py                       # gera gr√°ficos SHAP
python app.py                           # API em localhost:5000/predict
